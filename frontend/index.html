<!doctype html>
<html lang="en" class="dark">
    <head>
        <!-- Google Analytics 4 -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZTYG2V67XT"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-ZTYG2V67XT');
        </script>
        
        <!-- Tailwind CSS CDN (utilities used throughout the page) -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Font Awesome (icons used in UI) -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Favicons & PWA manifest -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" sizes="32x32" type="image/png" href="/static/icon-32x32.png">
    <link rel="icon" sizes="16x16" type="image/png" href="/static/icon-16x16.png">
        <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
        <link rel="manifest" href="/manifest.json">
    <!-- Project styles (loaded after Tailwind to allow overrides) -->
    <link rel="stylesheet" href="/css/styles.css?v=20251022c">
    <!-- Dark theme tokens and overrides -->
    <link rel="stylesheet" href="/css/dark-theme.css?v=20251022c">
        <!-- Strengthen no-cache for HTML in proxies/browsers -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <!-- Early Service Worker cleanup to avoid stale cached assets on first load -->
        <script>
        if ('serviceWorker' in navigator) {
            try {
                navigator.serviceWorker.getRegistrations().then(regs => {
                    for (const r of regs) { r.unregister(); }
                });
            } catch (e) {
                console.log('SW early cleanup failed', e);
            }
        }
        </script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#00e0ff" />
        <title>SHIOL+</title>
        <meta name="description" content="SHIOL+ Smart Outcomes Platform provides AI-powered Powerball analysis and instant ticket scanning. Get data-driven number insights and verify your tickets instantly." />
        <meta name="keywords" content="powerball analysis, AI lottery, ticket scanner, number insights, lottery predictions, powerball statistics" />
        
        <!-- Open Graph / Social Media -->
        <meta property="og:type" content="website" />
        <meta property="og:title" content="SHIOL+ | Smart Outcomes Platform" />
        <meta property="og:description" content="AI-powered Powerball analysis platform with instant ticket scanning and data-driven insights." />
        <meta property="og:url" content="https://shiolplus.com" />
        <meta property="og:image" content="/static/og-image.png" />
    </head>
    <body class="bg-canvas-bg min-h-screen">
        <!-- Dismissible Disclaimer Banner (Top of page) -->
        <div id="disclaimer-banner" class="bg-gradient-to-r from-amber-950/60 to-orange-950/60 border-b border-amber-500/50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 mt-0.5">
                        <i class="fas fa-exclamation-triangle text-amber-400 text-base sm:text-lg"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-amber-200 font-bold text-xs sm:text-sm md:text-base mb-1 sm:mb-2">IMPORTANT DISCLAIMER</h3>
                        
                        <!-- Mobile Version (very short) -->
                        <div class="block sm:hidden text-white/80 text-[11px] leading-tight space-y-1">
                            <p>
                                <strong class="text-amber-200">SHIOL+</strong> is an educational project. <span class="text-amber-100 font-semibold">DO NOT use for real gambling.</span> All predictions are experimental and not financial advice.
                            </p>
                        </div>
                        
                        <!-- Desktop Version (condensed) -->
                        <div class="hidden sm:block text-white/80 text-xs sm:text-sm space-y-1.5 sm:space-y-2">
                            <p>
                                <strong class="text-amber-200">SHIOL+</strong> is an educational portfolio project for demonstration purposes only. <span class="text-amber-100 font-semibold">‚ö†Ô∏è DO NOT use for real gambling or betting decisions.</span>
                            </p>
                            <p class="text-white/70">
                                All predictions are experimental AI models and should not be considered financial advice. Powerball is a game of chance. Always play responsibly.
                            </p>
                        </div>
                    </div>
                    <button 
                        id="close-disclaimer-banner" 
                        class="flex-shrink-0 text-white/60 hover:text-white transition-colors p-1"
                        aria-label="Close disclaimer"
                    >
                        <i class="fas fa-times text-base sm:text-lg"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Header / Navigation -->
        <!--#include virtual="/includes/header.html" -->

        <!-- Main Content -->
        <main class="max-w-2xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6">
            <div
                class="rounded-xl bg-gradient-to-b from-canvas-card to-canvas-surface border border-canvas-line p-4 sm:p-6 md:p-8 mb-4 sm:mb-6 text-center"
            >
                <!-- Hero Headline -->
                <div class="mb-4 sm:mb-6">
                    <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-2 sm:mb-3">
                        <span class="text-[#00e0ff]">Explore</span>
                        <span class="text-gray-300"> Powerball</span>
                        <span class="text-gray-300"> Through</span>
                        <span class="text-[#ff6b9d]"> AI Analysis</span>
                    </h1>
                    <p class="text-base sm:text-lg text-white/70">
                        Discover AI-generated insights for Powerball draws
                    </p>
                </div>

                <!-- Two Column Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4 md:mb-6">
                    <!-- Left Card: Current Jackpot -->
                    <div class="bg-canvas-card rounded-lg p-4 md:p-6 border border-canvas-line/50">
                        <div class="text-center">
                            <div class="text-xs md:text-sm font-medium text-white/70 mb-2 md:mb-3">Current Jackpot</div>
                            <div id="jackpot-display" class="text-3xl md:text-5xl font-bold text-white mb-3">
                                Loading...
                            </div>
                            <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-white/5 border border-cyan-500/30 rounded-lg">
                                <i class="far fa-clock text-cyan-400 text-xs"></i>
                                <span id="countdown-hero" class="text-sm font-bold text-cyan-400">Loading...</span>
                            </div>
                            <div id="next-drawing-date" class="text-xs font-medium text-white/50 mt-2">
                                Loading...
                            </div>
                        </div>
                    </div>

                    <!-- Right Card: AI Insights Performance -->
                    <div class="bg-canvas-card rounded-lg p-4 md:p-6 border border-canvas-line/50">
                        <div class="text-center">
                            <div class="text-xs md:text-sm font-medium text-white/70 mb-2 md:mb-3">Insights Performance</div>
                            <div id="winners-amount" class="text-3xl md:text-5xl font-bold text-white mb-2">
                                Loading...
                            </div>
                            <div id="winners-description" class="text-xs md:text-sm font-medium text-white/60">
                                matched historical draw results
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Disclaimer Badge -->
                <div class="text-center mt-6">
                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/5 border border-white/20 rounded-lg">
                        <i class="fas fa-info-circle text-white/60"></i>
                        <span class="text-sm text-white/60">For entertainment and educational purposes only</span>
                    </div>
                </div>
            </div>

            <!-- Recent Draws Section -->
            <div
                id="recent-draws-section"
                class="bg-canvas-card rounded-xl border border-canvas-line mb-6 sm:mb-8"
            >
                <div class="p-6 border-b border-canvas-line">
                    <h2
                        class="text-2xl font-bold text-white flex items-center"
                    >
                        <svg class="w-6 h-6 mr-3 text-canvas-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <rect x="3" y="4" width="18" height="18" rx="2" stroke-width="2"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"/>
                        </svg>
                        Recent Powerball Draws
                    </h2>
                    <p class="text-sm text-white/70 mt-1">
                        Click on any draw to see AI insights with matches.
                    </p>
                </div>

                <div class="p-6">
                    <div id="draws-loading" class="text-center py-8 hidden">
                        <i
                            class="fas fa-spinner fa-spin text-3xl text-canvas-accent mb-3"
                        ></i>
                        <p class="text-white/70">
                            Loading recent draws...
                        </p>
                    </div>

                    <div id="no-draws" class="text-center py-8 hidden">
                        <i
                            class="fas fa-info-circle text-3xl text-white/40 mb-3"
                        ></i>
                        <p class="text-white/70">
                            No recent Powerball draws found.
                        </p>
                    </div>

                    <div id="draws-grid" class="space-y-3">
                        <!-- Draws will be loaded here -->
                    </div>

                    <!-- Load More Button for Draws -->
                    <div
                        id="load-more-draws-container"
                        class="text-center mt-6 hidden"
                    >
                        <button
                            id="load-more-draws-btn"
                            class="inline-flex items-center px-6 py-3 btn-gradient-outline text-white font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow-md"
                        >
                            <i class="fas fa-plus-circle mr-2"></i>
                            <span id="load-more-draws-text"
                                >Load More Draws</span
                            >
                            <span
                                id="load-more-draws-count"
                                class="ml-2 px-2 py-1 bg-white/20 text-xs rounded-full"
                                >+10</span
                            >
                        </button>
                        <p class="text-xs text-white/60 mt-2">
                            Showing <span id="draws-shown-count">0</span> of
                            <span id="draws-total-available">0</span> draws
                        </p>
                    </div>
                </div>
            </div>

            <!-- AI Predictions Section -->
            <div
                id="predictions-section"
                class="bg-canvas-card rounded-xl border border-canvas-line mb-6 sm:mb-8"
            >
                <div class="p-6 border-b border-canvas-line">
                    <h2
                        class="text-2xl font-bold text-white flex items-center"
                    >
                        <svg class="w-6 h-6 mr-3 text-canvas-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <circle cx="12" cy="12" r="6" stroke-width="2"/>
                            <circle cx="12" cy="12" r="2" fill="currentColor"/>
                        </svg>
                        AI Insights for Next Drawing
                    </h2>
                    <p class="text-sm text-white/70 mt-2">
                        200 AI-generated insights for <span id="predictions-draw-date" class="text-white/90 font-medium">Next Drawing</span>
                    </p>
                    <p class="text-xs text-white/60 mt-1">
                        Last updated: <span id="predictions-timestamp">Loading...</span>
                    </p>
                </div>

                <div class="p-6">
                    <div
                        id="predictions-loading"
                        class="text-center py-8 hidden"
                    >
                        <i
                            class="fas fa-spinner fa-spin text-3xl text-canvas-accent mb-3"
                        ></i>
                        <p class="text-white/70">
                            Loading latest insights...
                        </p>
                    </div>

                    <div id="no-predictions" class="text-center py-8 hidden">
                        <i
                            class="fas fa-info-circle text-3xl text-white/40 mb-3"
                        ></i>
                        <p class="text-white/70">
                            No insights have been generated yet by the Smart
                            AI Pipeline.
                        </p>
                    </div>

                    <!-- Mobile list container -->
                    <div id="predictions-list" class="sm:hidden space-y-3 hidden"></div>

                    <div id="predictions-table" class="overflow-x-auto hidden sm:block">
                        <table
                            class="min-w-full divide-y divide-canvas-line"
                        >
                            <thead class="bg-canvas-surface hidden sm:table-header-group">
                                <tr>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                    >
                                        Rank
                                    </th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                    >
                                        Numbers + Powerball
                                    </th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                    >
                                        Status
                                    </th>
                                </tr>
                            </thead>
                            <tbody
                                id="predictions-tbody"
                                class="bg-canvas-card divide-y divide-canvas-line"
                            >
                                <!-- Predictions will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Load More Button -->
                    <div
                        id="load-more-container"
                        class="text-center mt-6 hidden"
                    >
                        <button
                            id="load-more-btn"
                            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-canvas-accent to-canvas-accent2 hover:opacity-90 text-white text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none touch-manipulation"
                        >
                            <i class="fas fa-plus-circle mr-2"></i>
                            <span id="load-more-text"
                                >Load More Insights</span
                            >
                            <span
                                id="load-more-count"
                                class="ml-2 px-2 py-1 bg-white/20 text-xs rounded-full"
                                >+10</span
                            >
                        </button>
                        <p
                            class="text-xs text-white/60 mt-2"
                        >
                            Showing <span id="shown-count">10</span> of
                            <span id="total-available">200</span> insights
                        </p>
                    </div>
                </div>
            </div>

            <!-- Ticket Verification Section -->
            <div
                class="bg-canvas-card rounded-xl border border-canvas-line mb-8"
            >
                <div class="p-6 border-b border-canvas-line">
                    <h2
                        class="text-2xl font-bold text-white flex items-center"
                    >
                        <svg class="w-6 h-6 mr-3 text-canvas-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" stroke-width="2"/>
                        </svg>
                        Verify Your Powerball Ticket
                    </h2>
                    <p class="text-sm text-white/60 mt-1">
                        Take a photo or upload an image of your Powerball ticket
                        to check if you've won!
                    </p>
                </div>

                <div class="p-6">
                    <!-- Camera/Upload Controls -->
                    <div class="mb-6">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <button
                                id="camera-btn"
                                class="flex-1 inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-canvas-accent to-canvas-accent2 hover:opacity-90 text-white font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none"
                            >
                                <i class="fas fa-camera mr-2"></i>
                                Take Photo
                            </button>
                            <button
                                id="upload-btn"
                                class="flex-1 inline-flex items-center justify-center px-6 py-3 btn-gradient-outline text-white font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none"
                            >
                                <i class="fas fa-upload mr-2"></i>
                                Upload Image
                            </button>
                        </div>

                        <!-- Hidden file input -->
                        <input
                            type="file"
                            id="ticket-file-input"
                            accept="image/*"
                            capture="environment"
                            class="hidden"
                        />

                        <!-- Image preview -->
                        <div id="image-preview-container" class="hidden mb-4">
                            <div class="relative">
                                <img
                                    id="image-preview"
                                    class="w-full max-w-md mx-auto rounded-lg shadow-md"
                                    alt="Ticket preview"
                                />
                                <button
                                    id="remove-image-btn"
                                    class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full w-8 h-8 flex items-center justify-center"
                                >
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Preview Numbers Button -->
                        <div
                            id="preview-btn-container"
                            class="hidden text-center mb-4"
                        >
                            <button
                                id="preview-numbers-btn"
                                class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-[#00e0ff] via-[#8b5cf6] to-[#ff4d6d] text-white font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200 shadow-lg"
                            >
                                <i class="fas fa-eye mr-2"></i>
                                Preview Numbers Detected
                            </button>
                        </div>

                        <!-- Numbers Preview Display -->
                        <div id="numbers-preview-container" class="hidden mb-4">
                            <div
                                class="bg-canvas-surface border border-canvas-line rounded-lg p-4"
                            >
                                <div class="flex items-center mb-3">
                                    <i
                                        class="fas fa-eye text-white/60 mr-2"
                                    ></i>
                                    <h4
                                        class="text-sm font-medium text-white"
                                    >
                                        Numbers Detected by OCR
                                    </h4>
                                    <span
                                        id="detection-confidence"
                                        class="ml-auto text-xs text-white/60"
                                    ></span>
                                </div>

                                <div id="detected-plays-list" class="space-y-2">
                                    <!-- Detected plays will be populated here -->
                                </div>

                                <div
                                    class="mt-3 pt-3 border-t border-canvas-line"
                                >
                                    <p
                                        class="text-xs text-white/70"
                                    >
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Review the numbers above. If they look
                                        incorrect, you can edit them manually
                                        after verification.
                                    </p>
                                    <p
                                        id="draw-date-preview"
                                        class="text-xs text-canvas-accent mt-1"
                                    ></p>
                                </div>
                            </div>
                        </div>

                        <!-- Verify button -->
                        <div
                            id="verify-btn-container"
                            class="hidden text-center"
                        >
                            <button
                                id="verify-ticket-btn"
                                class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-[#00e0ff] via-[#a855f7] to-[#ff6b9d] text-white font-bold rounded-lg hover:shadow-lg hover:shadow-[#00e0ff]/50 transition-all duration-300 transform hover:scale-105"
                            >
                                <i class="fas fa-sparkles mr-2"></i>
                                Verify Ticket
                            </button>
                        </div>
                    </div>

                    <!-- Processing Status -->
                    <div
                        id="verification-loading"
                        class="text-center py-8 hidden"
                    >
                        <i
                            class="fas fa-spinner fa-spin text-3xl text-canvas-accent mb-3"
                        ></i>
                        <p class="text-white/70 mb-2">
                            Processing your ticket...
                        </p>
                        <div class="text-sm text-white/60">
                            <p>‚Ä¢ Analyzing image quality</p>
                            <p>‚Ä¢ Extracting numbers with AI</p>
                            <p>‚Ä¢ Checking against official results</p>
                        </div>
                    </div>

                    <!-- Verification Results -->
                    <div id="verification-results" class="hidden">
                        <!-- Winner result -->
                        <div
                            id="winner-result"
                            class="hidden bg-canvas-surface p-6 rounded-lg border border-canvas-line mb-4"
                        >
                            <div class="text-center mb-4">
                                <i
                                    class="fas fa-trophy text-5xl mb-3 bg-gradient-to-r from-[#00e0ff] via-[#a855f7] to-[#ff6b9d] bg-clip-text text-transparent animate-pulse"
                                ></i>
                                <h3
                                    class="text-2xl font-bold text-white"
                                >
                                    üéâ CONGRATULATIONS! üéâ
                                </h3>
                                <p
                                    class="text-white/80 text-lg font-semibold"
                                >
                                    You have a winning ticket!
                                </p>
                            </div>
                            <div
                                class="bg-canvas-card rounded-lg p-4 mb-4 border border-[#00e0ff]/30 shadow-lg shadow-[#00e0ff]/20"
                            >
                                <div class="text-center">
                                    <p
                                        class="text-4xl font-bold bg-gradient-to-r from-[#00e0ff] via-[#a855f7] to-[#ff6b9d] bg-clip-text text-transparent"
                                        id="total-prize-amount"
                                    >
                                        $0.00
                                    </p>
                                    <p
                                        class="text-sm text-white/60"
                                    >
                                        AI Winnings
                                    </p>
                                </div>
                            </div>
                            <div id="winning-plays-details"></div>
                        </div>

                        <!-- No win result -->
                        <div
                            id="no-win-result"
                            class="hidden bg-canvas-surface p-6 rounded-lg border border-canvas-line mb-4"
                        >
                            <div class="text-center">
                                <i
                                    class="fas fa-times-circle text-4xl text-white/40 mb-3"
                                ></i>
                                <h3
                                    class="text-xl font-bold text-white"
                                >
                                    No Prize This Time
                                </h3>
                                <p class="text-white/70">
                                    Your ticket doesn't have any winning
                                    combinations for this draw.
                                </p>
                                <p
                                    class="text-sm text-white/60 mt-2"
                                >
                                    Better luck next time! üçÄ
                                </p>
                            </div>
                        </div>

                        <!-- Ticket details -->
                        <div
                            id="ticket-details"
                            class="bg-canvas-surface rounded-lg p-4 border border-canvas-line"
                        >
                            <h4
                                class="font-semibold text-white mb-3"
                            >
                                Ticket Information
                            </h4>
                            <div
                                class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm"
                            >
                                <div>
                                    <span
                                        class="text-white/60"
                                        >Draw Date:</span
                                    >
                                    <span
                                        id="ticket-draw-date"
                                        class="font-medium text-white ml-2"
                                        >-</span
                                    >
                                </div>
                                <div>
                                    <span
                                        class="text-white/60"
                                        >Total Plays:</span
                                    >
                                    <span
                                        id="ticket-total-plays"
                                        class="font-medium text-white ml-2"
                                        >-</span
                                    >
                                </div>
                            </div>

                            <!-- Official winning numbers -->
                            <div class="mt-4">
                                <p
                                    class="text-sm text-white/60 mb-2"
                                >
                                    Official Winning Numbers:
                                </p>
                                <div class="flex flex-wrap items-center gap-2">
                                    <div
                                        id="official-numbers"
                                        class="flex flex-wrap gap-1"
                                    >
                                        <!-- Official numbers will be inserted here -->
                                    </div>
                                    <span
                                        class="text-sm text-white/60 mx-1"
                                        >PB:</span
                                    >
                                    <div id="official-powerball">
                                        <!-- Official powerball will be inserted here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Your numbers -->
                            <div id="your-plays" class="mt-4">
                                <p
                                    class="text-sm text-white/60 mb-2"
                                >
                                    Your Numbers:
                                </p>
                                <!-- Dedicated container for your numbers list -->
                                <div id="your-numbers-list" class="mt-2 space-y-2">
                                    <!-- Player's numbers will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Date Input -->
                    <div
                        id="manual-date-section"
                        class="hidden bg-canvas-surface p-4 rounded-lg border border-gray-600/30 mb-4"
                    >
                        <div class="flex items-start">
                            <i
                                class="fas fa-exclamation-circle text-gray-400 mr-3 mt-1"
                            ></i>
                            <div class="flex-1">
                                <h4
                                    class="font-semibold text-white mb-2"
                                >
                                    Date Detection Failed
                                </h4>
                                <p
                                    class="text-white/70 text-sm mb-3"
                                >
                                    We couldn't automatically detect the draw
                                    date from your ticket. Please enter the draw
                                    date manually to continue verification.
                                </p>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <div class="flex-1">
                                        <label
                                            for="manual-date-input"
                                            class="block text-sm font-medium text-white mb-1"
                                        >
                                            Draw Date (YYYY-MM-DD):
                                        </label>
                                        <input
                                            type="date"
                                            id="manual-date-input"
                                            class="w-full px-3 py-2 border border-canvas-line rounded-md bg-canvas-card text-white focus:outline-none focus:ring-2 focus:ring-canvas-accent"
                                            min="2025-01-01"
                                            max="2025-12-31"
                                        />
                                    </div>
                                    <div class="flex gap-2">
                                        <button
                                            id="verify-with-manual-date-btn"
                                            class="px-4 py-2 bg-gray-600 hover:opacity-90 text-white rounded-md font-medium transition-opacity duration-200"
                                        >
                                            <i class="fas fa-search mr-1"></i>
                                            Verify
                                        </button>
                                        <button
                                            id="cancel-manual-date-btn"
                                            class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-md font-medium transition-colors duration-200"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Play Entry -->
                    <div
                        id="manual-play-entry"
                        class="hidden bg-canvas-surface p-4 rounded-lg border border-canvas-line mb-4"
                    >
                        <div class="flex items-start">
                            <i class="fas fa-edit text-canvas-accent mr-3 mt-1"></i>
                            <div class="flex-1">
                                <h4
                                    class="font-semibold text-white mb-2"
                                >
                                    Enter Lottery Numbers Manually
                                </h4>
                                <p
                                    class="text-white/70 text-sm mb-4"
                                >
                                    Enter your lottery numbers below. You can
                                    enter up to 5 plays. Each play requires 5
                                    main numbers (1-69) and 1 Powerball number
                                    (1-26).
                                </p>

                                <!-- Manual plays input grid -->
                                <div class="space-y-4">
                                    <!-- Play 1 -->
                                    <div
                                        class="bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-700"
                                    >
                                        <div class="flex items-center mb-2">
                                            <span
                                                class="text-sm font-medium text-blue-800 dark:text-blue-200"
                                                >Play 1:</span
                                            >
                                        </div>
                                        <div class="grid grid-cols-6 gap-2">
                                            <input
                                                type="number"
                                                id="play-1-num-1"
                                                min="1"
                                               
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-1-num-2"
                                                min="1"
                                               
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-1-num-3"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-1-num-4"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-1-num-5"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-1-pb"
                                                min="1"
                                                max="26"
                                                placeholder="PB 1-26"
                                                class="px-2 py-1 text-center border border-red-300 dark:border-red-600 rounded text-sm bg-red-50 dark:bg-red-900/20 text-gray-900 dark:text-white focus:ring-2 focus:ring-red-500"
                                            />
                                        </div>
                                    </div>

                                    <!-- Play 2 -->
                                    <div
                                        class="bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-700"
                                    >
                                        <div class="flex items-center mb-2">
                                            <span
                                                class="text-sm font-medium text-blue-800 dark:text-blue-200"
                                                >Play 2:</span
                                            >
                                        </div>
                                        <div class="grid grid-cols-6 gap-2">
                                            <input
                                                type="number"
                                                id="play-2-num-1"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-2-num-2"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-2-num-3"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-2-num-4"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-2-num-5"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-2-pb"
                                                min="1"
                                                max="26"
                                                placeholder="PB 1-26"
                                                class="px-2 py-1 text-center border border-red-300 dark:border-red-600 rounded text-sm bg-red-50 dark:bg-red-900/20 text-gray-900 dark:text-white focus:ring-2 focus:ring-red-500"
                                            />
                                        </div>
                                    </div>

                                    <!-- Play 3 -->
                                    <div
                                        class="bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-700"
                                    >
                                        <div class="flex items-center mb-2">
                                            <span
                                                class="text-sm font-medium text-blue-800 dark:text-blue-200"
                                                >Play 3:</span
                                            >
                                        </div>
                                        <div class="grid grid-cols-6 gap-2">
                                            <input
                                                type="number"
                                                id="play-3-num-1"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-3-num-2"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-3-num-3"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-3-num-4"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-3-num-5"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-3-pb"
                                                min="1"
                                                max="26"
                                                placeholder="PB 1-26"
                                                class="px-2 py-1 text-center border border-red-300 dark:border-red-600 rounded text-sm bg-red-50 dark:bg-red-900/20 text-gray-900 dark:text-white focus:ring-2 focus:ring-red-500"
                                            />
                                        </div>
                                    </div>

                                    <!-- Play 4 -->
                                    <div
                                        class="bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-700"
                                    >
                                        <div class="flex items-center mb-2">
                                            <span
                                                class="text-sm font-medium text-blue-800 dark:text-blue-200"
                                                >Play 4:</span
                                            >
                                        </div>
                                        <div class="grid grid-cols-6 gap-2">
                                            <input
                                                type="number"
                                                id="play-4-num-1"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-4-num-2"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-4-num-3"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-4-num-4"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-4-num-5"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-4-pb"
                                                min="1"
                                                max="26"
                                                placeholder="PB 1-26"
                                                class="px-2 py-1 text-center border border-red-300 dark:border-red-600 rounded text-sm bg-red-50 dark:bg-red-900/20 text-gray-900 dark:text-white focus:ring-2 focus:ring-red-500"
                                            />
                                        </div>
                                    </div>

                                    <!-- Play 5 -->
                                    <div
                                        class="bg-white dark:bg-gray-800 p-3 rounded border border-blue-200 dark:border-blue-700"
                                    >
                                        <div class="flex items-center mb-2">
                                            <span
                                                class="text-sm font-medium text-blue-800 dark:text-blue-200"
                                                >Play 5:</span
                                            >
                                        </div>
                                        <div class="grid grid-cols-6 gap-2">
                                            <input
                                                type="number"
                                                id="play-5-num-1"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-5-num-2"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-5-num-3"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-5-num-4"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-5-num-5"
                                                min="1"
                                                max="69"
                                                placeholder="1-69"
                                                class="px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                                            />
                                            <input
                                                type="number"
                                                id="play-5-pb"
                                                min="1"
                                                max="26"
                                                placeholder="PB 1-26"
                                                class="px-2 py-1 text-center border border-red-300 dark:border-red-600 rounded text-sm bg-red-50 dark:bg-red-900/20 text-gray-900 dark:text-white focus:ring-2 focus:ring-red-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <!-- Draw date selection -->
                                <div
                                    class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded border"
                                >
                                    <label
                                        for="manual-draw-date"
                                        class="block text-sm font-medium text-blue-800 dark:text-blue-200 mb-1"
                                    >
                                        Draw Date:
                                    </label>
                                    <input
                                        type="date"
                                        id="manual-draw-date"
                                        class="w-full max-w-xs px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        min="2025-01-01"
                                        max="2025-12-31"
                                        value="2025-08-02"
                                    />
                                </div>

                                <!-- Action buttons -->
                                <div
                                    class="flex flex-col sm:flex-row gap-2 mt-4"
                                >
                                    <button
                                        onclick="ticketVerification.verifyManualPlays()"
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                                    >
                                        <i class="fas fa-check mr-1"></i>
                                        Verify Numbers
                                    </button>
                                    <button
                                        onclick="ticketVerification.hideManualPlayEntry()"
                                        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
                                    >
                                        <i class="fas fa-times mr-1"></i>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Error Display -->
                    <div
                        id="verification-error"
                        class="hidden bg-red-50 dark:bg-red-900/30 p-4 rounded-lg border border-red-200 dark:border-red-800"
                    >
                        <div class="flex items-center">
                            <i
                                class="fas fa-exclamation-triangle text-red-600 mr-2"
                            ></i>
                            <div>
                                <h4
                                    class="font-semibold text-red-800 dark:text-red-200"
                                >
                                    Verification Error
                                </h4>
                                <p
                                    id="error-message"
                                    class="text-red-700 dark:text-red-300 text-sm mt-1"
                                ></p>
                            </div>
                        </div>
                    </div>

                    <!-- Tips for better results -->
                    <div
                        class="mt-6 bg-canvas-surface p-4 rounded-lg border border-canvas-line"
                    >
                        <h4
                            class="font-semibold text-white mb-2"
                        >
                            <i class="fas fa-lightbulb mr-2 text-canvas-accent"></i>
                            Tips for Best Results
                        </h4>
                        <ul
                            class="text-sm text-white/70 space-y-1"
                        >
                            <li>
                                ‚Ä¢ Make sure the ticket is well-lit and clearly
                                visible
                            </li>
                            <li>
                                ‚Ä¢ Keep the camera steady and focus on the
                                numbers
                            </li>
                            <li>‚Ä¢ Avoid shadows or glare on the ticket</li>
                            <li>‚Ä¢ Include the entire ticket in the photo</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>

        <!-- Draw Matches Modal -->
        <div
            id="drawMatchesModal"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"
        >
            <div
                class="bg-canvas-card rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden border border-canvas-line"
            >
                <!-- Modal Header -->
                <div
                    class="px-6 py-5 border-b border-canvas-line flex justify-between items-center"
                >
                    <div>
                        <h3
                            class="text-2xl font-bold mb-1"
                        >
                            <span class="text-canvas-accent">Smart Insights</span> <span class="text-white/90">vs Draw</span> <span class="text-canvas-secondary">Results</span>
                        </h3>
                        <p
                            id="modal-draw-date"
                            class="text-sm text-white/70"
                        ></p>
                    </div>
                    <button
                        onclick="closeDrawMatchesModal()"
                        class="text-white/40 hover:text-white/80 transition-colors"
                    >
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-6 overflow-y-auto max-h-[75vh]">
                    <!-- Loading State -->
                    <div id="modal-loading" class="text-center py-8">
                        <i
                            class="fas fa-spinner fa-spin text-3xl text-canvas-accent mb-3"
                        ></i>
                        <p class="text-white/70">
                            Loading AI insights data...
                        </p>
                    </div>

                    <!-- Empty State -->
                    <div id="modal-empty" class="text-center py-8 hidden">
                        <i
                            class="fas fa-info-circle text-3xl text-white/40 mb-3"
                        ></i>
                        <p class="text-white/70">
                            No AI insights found for this draw date.
                        </p>
                    </div>

                    <!-- Content -->
                    <div id="modal-content" class="hidden">
                        <!-- Winning Numbers Display -->
                        <div
                            class="bg-canvas-surface p-5 rounded-lg border border-canvas-line mb-6"
                        >
                            <h4
                                class="text-sm font-medium text-white/70 mb-3"
                            >
                                Winning Numbers
                            </h4>
                            <div class="flex items-center gap-2">
                                <div
                                    id="modal-winning-numbers"
                                    class="flex gap-2"
                                >
                                    <!-- Winning numbers will be inserted here -->
                                </div>
                                <span
                                    class="text-sm text-white/70 mx-1"
                                    >PB:</span
                                >
                                <div id="modal-winning-powerball">
                                    <!-- Winning powerball will be inserted here -->
                                </div>
                            </div>
                        </div>

                        <!-- Summary Stats -->
                        <div
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"
                        >
                            <div
                                class="bg-[#1a1f2e] p-5 rounded-lg border border-white/5"
                            >
                                <div
                                    class="text-3xl font-bold text-white mb-1"
                                    id="modal-total-predictions"
                                >
                                    0
                                </div>
                                <div
                                    class="text-sm text-white/60"
                                >
                                    Total Insights
                                </div>
                            </div>
                            <div
                                class="bg-[#1a1f2e] p-5 rounded-lg border border-white/5"
                            >
                                    <div class="flex items-baseline gap-2">
                                        <div
                                            class="text-3xl font-bold text-white"
                                    id="modal-matches-found"
                                >
                                    0
                                </div>
                                        <div
                                            class="text-sm text-white/40"
                                            id="modal-win-rate"
                                        >
                                            (0%)
                                        </div>
                                    </div>
                                <div
                                    class="text-sm text-white/60"
                                >
                                    With Matches
                                </div>
                            </div>
                            <div
                                class="bg-[#1a1f2e] p-5 rounded-lg border border-white/5"
                            >
                                <div class="flex items-baseline gap-2">
                                    <div
                                        class="text-3xl font-bold text-white"
                                        id="modal-best-match"
                                    >
                                        None
                                    </div>
                                    <div
                                        class="text-sm text-white/40"
                                        id="modal-best-match-tier"
                                    ></div>
                                </div>
                                <div
                                    class="text-sm text-white/60"
                                >
                                    Best Match
                                </div>
                            </div>
                            <div
                                class="bg-[#1a1f2e] p-5 rounded-lg border border-white/5"
                            >
                                <div
                                    class="text-2xl font-bold bg-gradient-to-r from-[#00e0ff] via-[#a855f7] to-[#ff6b9d] bg-clip-text text-transparent mb-1"
                                    id="modal-total-prizes"
                                >
                                    $0.00
                                </div>
                                <div
                                    class="text-sm text-white/60"
                                >
                                    AI Winnings
                                </div>
                            </div>
                        </div>

                        <!-- Predictions Table -->
                        <!-- Mobile list container -->
                        <div id="modal-predictions-list" class="sm:hidden space-y-3 bg-canvas-surface rounded-lg border border-canvas-line p-3"></div>

                        <!-- Desktop table -->
                        <div class="hidden sm:block overflow-x-auto bg-canvas-surface rounded-lg border border-canvas-line">
                            <table
                                class="min-w-full"
                            >
                                <thead class="bg-canvas-card/50">
                                    <tr>
                                        <th
                                            class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                        >
                                            Rank
                                        </th>
                                        <th
                                            class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                        >
                                            Numbers
                                        </th>
                                        <th
                                            class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                        >
                                            PB
                                        </th>
                                        <th
                                            class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                            >
                                                Strategy
                                            </th>
                                            <th
                                                class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                        >
                                            Matches
                                        </th>
                                        <th
                                            class="px-4 py-3 text-left text-xs font-medium text-white/60 uppercase tracking-wider"
                                        >
                                            Prize
                                        </th>
                                    </tr>
                                </thead>
                                <tbody
                                    id="modal-predictions-tbody"
                                    class="divide-y divide-canvas-line"
                                >
                                    <!-- AI insight matches will be loaded here -->
                                </tbody>
                            </table>
                                <div id="modal-no-winners" class="hidden text-center py-8 text-white/60">
                                    <i class="fas fa-info-circle text-2xl mb-2"></i>
                                    <p>No winning insights for this draw.</p>
                                </div>
                        </div>
                        
                            <!-- Strategy Breakdown Section -->
                            <div id="modal-strategy-section" class="hidden mt-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-chart-bar text-canvas-secondary"></i>
                                        <h4 class="text-lg font-semibold text-white">Strategy Breakdown</h4>
                                    </div>
                                    <div class="flex gap-2">
                                        <button
                                            onclick="window.switchStrategyView('ranking')"
                                            id="btn-strategy-ranking"
                                            class="px-3 py-1 text-sm rounded bg-canvas-accent text-white font-medium"
                                        >
                                            Ranking
                                        </button>
                                        <button
                                            onclick="window.switchStrategyView('bars')"
                                            id="btn-strategy-bars"
                                            class="px-3 py-1 text-sm rounded bg-canvas-surface text-white/70 hover:bg-canvas-accent/30"
                                        >
                                            Bars
                                        </button>
                                    </div>
                                </div>
                                <div id="strategy-content-container">
                                    <!-- Strategy content will be rendered here -->
                                </div>
                            </div>

                            <!-- Match Distribution + Prize Tiers (Two Columns) -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                                <!-- Match Distribution -->
                                <div id="modal-distribution-section" class="hidden">
                                    <div class="flex items-center gap-2 mb-4">
                                        <i class="fas fa-chart-pie text-canvas-accent"></i>
                                        <h4 class="text-lg font-semibold text-white">Match Distribution</h4>
                                    </div>
                                    <div id="distribution-content" class="space-y-3">
                                        <!-- Distribution bars will be rendered here -->
                                    </div>
                                </div>

                                <!-- Prize Tiers -->
                                <div id="modal-prize-tiers-section" class="hidden">
                                    <div class="flex items-center gap-2 mb-4">
                                        <i class="fas fa-trophy text-yellow-400"></i>
                                        <h4 class="text-lg font-semibold text-white">Prize Tiers</h4>
                                    </div>
                                    <div id="prize-tiers-content" class="space-y-2">
                                        <!-- Prize tiers will be rendered here -->
                                    </div>
                                </div>
                            </div>

                        <!-- Close Button -->
                        <div class="mt-6 text-center">
                            <button
                                onclick="closeDrawMatchesModal()"
                                class="px-8 py-3 bg-gradient-to-r from-[#00e0ff] via-[#8b5cf6] to-[#ff4d6d] text-white font-semibold rounded-lg hover:opacity-90 transition-opacity"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                console.log("Frontend loading...");

                // Disclaimer banner management (temporary dismiss, reappears on refresh)
                const disclaimerBanner = document.getElementById('disclaimer-banner');
                const closeDisclaimerBtn = document.getElementById('close-disclaimer-banner');
                
                // Handle close button click - only hides until page refresh
                if (closeDisclaimerBtn && disclaimerBanner) {
                    closeDisclaimerBtn.addEventListener('click', () => {
                        disclaimerBanner.style.opacity = '0';
                        disclaimerBanner.style.transition = 'opacity 0.3s ease-out';
                        setTimeout(() => {
                            disclaimerBanner.style.display = 'none';
                        }, 300);
                    });
                }

                // Check if login modal should be opened (e.g., from /status redirect)
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('login') === 'required') {
                    // Wait for AuthManager to be ready
                    setTimeout(() => {
                        if (window.authManager) {
                            window.authManager.showLoginModal();
                            console.log('Login modal opened from URL parameter');
                        }
                        // Clean URL without reloading
                        const cleanUrl = window.location.pathname;
                        window.history.replaceState({}, document.title, cleanUrl);
                    }, 500);
                }

                // Clear active selection when tapping outside of cards (mobile)
                document.addEventListener('click', (e) => {
                    const list = document.getElementById('predictions-list');
                    if (!list) return;
                    if (activePredictionCard && !list.contains(e.target)) {
                        activePredictionCard.classList.remove('active');
                        activePredictionCard = null;
                    }
                });

                // Update current time (only if element exists)
                function updateCurrentTime() {
                    const timeElement = document.getElementById("current-time");
                    if (!timeElement) return; // Skip if element doesn't exist
                    
                    const now = new Date();
                    const timeString = now.toLocaleTimeString("en-US", {
                        timeZone: "America/New_York",
                        hour: "2-digit",
                        minute: "2-digit",
                        second: "2-digit",
                        hour12: true,
                    });
                    timeElement.textContent = `${timeString} ET`;
                }

                updateCurrentTime();
                setInterval(updateCurrentTime, 1000);

                // Countdown is now handled by CountdownUtils (see bottom of script)
                // initializeCountdown();

                const API_BASE_URL = window.location.origin + "/api/v1";

                // Global variables for pagination
                let allPredictions = [];
                let currentlyShown = 0;
                const PREDICTIONS_PER_LOAD = 10;
                // Active selection (mobile)
                let activePredictionCard = null;
                function setActivePredictionCard(card) {
                    if (activePredictionCard === card) return;
                    if (activePredictionCard) activePredictionCard.classList.remove('active');
                    activePredictionCard = card;
                    if (card) card.classList.add('active');
                }

                // Global variables for draws pagination
                let allDraws = [];
                let drawsCurrentlyShown = 0;
                const DRAWS_PER_LOAD = 10;

                // Load jackpot information
                async function loadJackpot() {
                    try {
                        const response = await fetch(`${API_BASE_URL}/public/jackpot`);
                        if (!response.ok) throw new Error("Failed to fetch jackpot");
                        
                        const data = await response.json();
                        
                        const jackpotDisplay = document.getElementById("jackpot-display");
                        const nextDrawingDate = document.getElementById("next-drawing-date");
                        
                        if (data.status === "success" && data.nextPrizeText) {
                            if (jackpotDisplay) {
                                jackpotDisplay.textContent = data.nextPrizeText || "Loading...";
                            }
                            
                            // Note: next-drawing-date is now handled by countdown badge
                            // No need to update it here to avoid conflicts
                        } else {
                            if (jackpotDisplay) {
                                jackpotDisplay.textContent = "Jackpot unavailable";
                            }
                        }
                    } catch (error) {
                        console.error("Error loading jackpot:", error);
                        const jackpotDisplay = document.getElementById("jackpot-display");
                        if (jackpotDisplay) {
                            jackpotDisplay.textContent = "Jackpot unavailable";
                        }
                    }
                }

                // Load winners stats
                async function loadWinnersStats() {
                    try {
                        const response = await fetch(`${API_BASE_URL}/public/winners-stats`);
                        if (!response.ok) throw new Error("Failed to fetch winners stats");
                        
                        const data = await response.json();
                        
                        const winnersAmount = document.getElementById("winners-amount");
                        
                        if (data.status === "success") {
                            if (winnersAmount) {
                                winnersAmount.textContent = data.formatted_amount || "$0";
                            }
                            // Note: winners-description text is static HTML, not updated dynamically
                        } else {
                            if (winnersAmount) {
                                winnersAmount.textContent = "$0";
                            }
                        }
                    } catch (error) {
                        console.error("Error loading winners stats:", error);
                        const winnersAmount = document.getElementById("winners-amount");
                        if (winnersAmount) {
                            winnersAmount.textContent = "$0";
                        }
                    }
                }

                // Load user stats
                async function loadStats() {
                    try {
                        const response = await fetch(`${API_BASE_URL}/public/stats`);
                        if (!response.ok) throw new Error("Failed to fetch stats");
                        
                        const data = await response.json();
                        
                        if (data.status === "success") {
                            const winningSets = data.totalWinningSets || 0;
                            const prizeText = data.prizeText || "$0";
                            
                            // Update stats pills in hero area
                            const winningSetsPill = document.getElementById("stats-winning-sets-pill");
                            const prizeTextPill = document.getElementById("stats-prize-text-pill");
                            
                            if (winningSetsPill) winningSetsPill.textContent = winningSets;
                            if (prizeTextPill) prizeTextPill.textContent = prizeText;
                        } else {
                            // Fallback for non-success status
                            const winningSetsPill = document.getElementById("stats-winning-sets-pill");
                            const prizeTextPill = document.getElementById("stats-prize-text-pill");
                            
                            if (winningSetsPill) winningSetsPill.textContent = "0";
                            if (prizeTextPill) prizeTextPill.textContent = "$0";
                        }
                    } catch (error) {
                        console.error("Error loading stats:", error);
                        // Fallback for errors
                        const winningSetsPill = document.getElementById("stats-winning-sets-pill");
                        const prizeTextPill = document.getElementById("stats-prize-text-pill");
                        
                        if (winningSetsPill) winningSetsPill.textContent = "0";
                        if (prizeTextPill) prizeTextPill.textContent = "$0";
                    }
                }

                // Load predictions
                async function loadPredictions() {
                    try {
                        console.log("Loading predictions...");
                        document
                            .getElementById("predictions-loading")
                            .classList.remove("hidden");

                        const response = await fetch(
                            `${API_BASE_URL}/public/predictions/latest?limit=200`,
                        );
                        if (!response.ok)
                            throw new Error("Failed to fetch predictions");

                        const data = await response.json();
                        allPredictions = data.predictions || [];
                        console.log(
                            "Loaded predictions:",
                            allPredictions.length,
                        );

                        if (allPredictions.length === 0) {
                            document
                                .getElementById("predictions-loading")
                                .classList.add("hidden");
                            document
                                .getElementById("no-predictions")
                                .classList.remove("hidden");
                            return;
                        }

                        // Update totals and timestamp
                        document.getElementById("total-available").textContent =
                            allPredictions.length;

                        // Update draw date
                        if (allPredictions.length > 0 && allPredictions[0].draw_date) {
                            const drawDateStr = allPredictions[0].draw_date;
                            try {
                                // Parse draw_date (format: YYYY-MM-DD)
                                const [year, month, day] = drawDateStr.split('-').map(Number);
                                const drawDate = new Date(year, month - 1, day);
                                const formattedDrawDate = drawDate.toLocaleDateString('en-US', {
                                    weekday: 'long',
                                    month: 'long',
                                    day: 'numeric',
                                    timeZone: 'America/New_York'
                                });
                                
                                const drawDateElement = document.getElementById('predictions-draw-date');
                                if (drawDateElement) {
                                    drawDateElement.textContent = formattedDrawDate;
                                }
                            } catch (e) {
                                console.warn('Error formatting draw date:', e);
                            }
                        }

                        // Update prediction creation timestamp
                        if (
                            allPredictions.length > 0 &&
                            allPredictions[0].prediction_date
                        ) {
                            const predictionDate = new Date(
                                allPredictions[0].prediction_date,
                            );
                            const formattedDate =
                                predictionDate.toLocaleDateString("en-US", {
                                    year: "numeric",
                                    month: "short",
                                    day: "numeric",
                                    timeZone: "America/New_York",
                                });
                            const formattedTime =
                                predictionDate.toLocaleTimeString("en-US", {
                                    hour: "numeric",
                                    minute: "2-digit",
                                    hour12: true,
                                    timeZone: "America/New_York",
                                });

                            const timestampElement = document.getElementById(
                                "predictions-timestamp",
                            );
                            if (timestampElement) {
                                timestampElement.textContent = `${formattedDate}, ${formattedTime} ET`;
                            }
                        }

                        // Update footer last updated timestamp
                        if (
                            allPredictions.length > 0 &&
                            allPredictions[0].created_at
                        ) {
                            const lastUpdated = new Date(
                                allPredictions[0].created_at,
                            );
                            const formattedLastUpdated =
                                lastUpdated.toLocaleDateString("en-US", {
                                    year: "numeric",
                                    month: "short",
                                    day: "numeric",
                                    timeZone: "America/New_York",
                                });
                            const formattedLastUpdatedTime =
                                lastUpdated.toLocaleTimeString("en-US", {
                                    hour: "numeric",
                                    minute: "2-digit",
                                    hour12: true,
                                    timeZone: "America/New_York",
                                });

                            const lastUpdatedElement =
                                document.getElementById("last-updated");
                            if (lastUpdatedElement) {
                                lastUpdatedElement.textContent = `${formattedLastUpdated} at ${formattedLastUpdatedTime} ET`;
                            }
                        }

                        // Initialize pagination
                        currentlyShown = 0;
                        const tbody = document.getElementById("predictions-tbody");
                        const list = document.getElementById("predictions-list");
                        const isMobile = window.innerWidth < 640;
                        tbody.innerHTML = "";
                        if (list) list.innerHTML = "";

                        // Show initial predictions
                        showMorePredictions();

                        document.getElementById("predictions-loading").classList.add("hidden");
                        if (isMobile) {
                            document.getElementById("predictions-list").classList.remove("hidden");
                            document.getElementById("predictions-table").classList.add("hidden");
                        } else {
                            document.getElementById("predictions-table").classList.remove("hidden");
                            const listEl = document.getElementById("predictions-list");
                            if (listEl) listEl.classList.add("hidden");
                        }
                    } catch (error) {
                        console.error("Error loading predictions:", error);
                        document
                            .getElementById("predictions-loading")
                            .classList.add("hidden");
                        document
                            .getElementById("no-predictions")
                            .classList.remove("hidden");
                    }
                }

                // Make loadPredictions globally accessible for auth-manager
                window.loadPredictions = loadPredictions;

                // Show more predictions function
                function showMorePredictions() {
                    const tbody = document.getElementById("predictions-tbody");
                    const list = document.getElementById("predictions-list");
                    const isMobile = window.innerWidth < 640;
                    const startIndex = currentlyShown;
                    const endIndex = Math.min(
                        currentlyShown + PREDICTIONS_PER_LOAD,
                        allPredictions.length,
                    );

                    // Add new predictions to table
                    for (let i = startIndex; i < endIndex; i++) {
                        const pred = allPredictions[i];
                        const rank = i + 1;
                        const isLocked = pred.access_type === 'locked';
                        
                        // Mobile: render into list container, not table
                        if (isMobile) {
                            const cardDiv = document.createElement("div");
                            cardDiv.className = `prediction-card bg-canvas-card rounded-lg border border-white/5 p-4 space-y-3 ${isLocked ? 'locked-prediction' : ''}`;
                            
                            // Header: rank badge + status/lock with bottom divider
                            const rankHTML = `
                                <div class="flex items-center justify-between border-b border-white/5 pb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="inline-flex items-center justify-center w-8 h-6 rounded-md ${rank <= 10 ? "bg-gradient-to-r from-canvas-accent to-canvas-accent2 text-white" : "bg-white/10 text-white/70"} text-sm font-bold shadow-md">
                                            #${rank}
                                        </span>
                                        ${isLocked ? '<span class="text-white/60 text-sm">Premium</span>' : '<span class="text-emerald-400 text-sm font-medium">Unlocked</span>'}
                                    </div>
                                    ${isLocked ? '<i class="fas fa-lock text-white/40 text-lg"></i>' : '<i class="fas fa-chevron-right text-white/30 text-lg"></i>'}
                                </div>
                            `;
                            
                            // Numbers row
                            const numberBalls = [pred.n1, pred.n2, pred.n3, pred.n4, pred.n5]
                                .filter((n) => n)
                                .map((num) => `<span class=\"num-chip text-xs w-7 h-7\">${num}</span>`)
                                .join("");
                            
                            const numbersHTML = `
                                <div class="flex items-center justify-center gap-1.5 flex-wrap ${isLocked ? 'blur-sm opacity-70' : ''}">
                                    ${numberBalls}
                                    <div class="w-0.5"></div>
                                    <span class="num-chip powerball-chip text-xs w-7 h-7">${pred.pb}</span>
                                </div>
                            `;
                            
                            // Meta row: Confidence value (or dash for locked)
                            const confVal = (typeof pred.confidence_score === 'number') ? pred.confidence_score : ((typeof pred.confidence === 'number') ? pred.confidence : null);
                            const confPct = confVal !== null ? `${Math.round(confVal * 100)}%` : '‚Äî';
                            const metaHTML = `
                                <div class="flex items-center justify-between pt-1 border-t border-white/5">
                                    <span class="text-[10px] text-white/50 uppercase tracking-wide">Confidence</span>
                                    <span class="text-xs text-white/80">${confPct}</span>
                                </div>
                            `;
                            
                            cardDiv.innerHTML = rankHTML + numbersHTML + metaHTML;
                            
                            if (isLocked) {
                                cardDiv.addEventListener('click', openUpgradeModal);
                                cardDiv.style.cursor = 'pointer';
                            } else {
                                cardDiv.addEventListener('click', (e) => {
                                    // Avoid clearing on internal elements
                                    e.stopPropagation();
                                    setActivePredictionCard(cardDiv);
                                });
                                cardDiv.style.cursor = 'pointer';
                            }
                            
                            list.appendChild(cardDiv);
                            continue;
                        }
                        
                        // Desktop: Apply base classes and locked class if needed
                        let rowClasses = "hover:bg-canvas-surface/50 transition-colors";
                        if (isLocked) {
                            rowClasses += " locked-prediction";
                        }
                        const row = document.createElement("tr");
                        row.className = rowClasses;

                        // Create rank cell with canvas gradient
                        const rankCell = document.createElement("td");
                        rankCell.className = "px-4 py-3 whitespace-nowrap";
                        rankCell.innerHTML = `
                            <span class="inline-flex items-center justify-center w-8 h-6 rounded-md ${rank <= 10 ? "bg-gradient-to-r from-canvas-accent to-canvas-accent2 text-white" : "bg-white/10 text-white/70"} text-sm font-bold shadow-md">
                                #${rank}
                            </span>
                        `;

                        // Create numbers cell - simplified, just apply blur when locked
                        const numbersCell = document.createElement("td");
                        numbersCell.className = "px-4 py-3 whitespace-nowrap";
                        
                        // Create numbers container with conditional blur
                        const numbersContainer = document.createElement("div");
                        numbersContainer.className = "flex items-center space-x-1";
                        
                        // Apply blur effect to locked predictions
                        if (isLocked) {
                            numbersContainer.style.filter = "blur(6px)";
                            numbersContainer.style.opacity = "0.7";
                        }
                        
                        // Generate number balls HTML with dark theme
                        const numberBalls = [pred.n1, pred.n2, pred.n3, pred.n4, pred.n5]
                            .filter((n) => n)
                            .map((num) => 
                                `<span class="num-chip">${num}</span>`
                            )
                            .join("");
                        
                        numbersContainer.innerHTML = `
                            ${numberBalls}
                            <div class="w-2"></div>
                            <span class="num-chip powerball-chip">
                                ${pred.pb}
                            </span>
                        `;
                        
                        numbersCell.appendChild(numbersContainer);

                        // Create status cell - simplified design
                        const statusCell = document.createElement("td");
                        statusCell.className = "px-4 py-3 whitespace-nowrap";
                        
                        if (isLocked) {
                            // Locked: simple lock icon
                            const lockButton = document.createElement("button");
                            lockButton.className = "text-white/40 hover:text-white/60 transition-colors duration-200 cursor-pointer text-lg";
                            lockButton.innerHTML = '<i class="fas fa-lock"></i>';
                            lockButton.title = "Click to upgrade to Premium";
                            
                            // Add click handler for upgrade modal
                            lockButton.addEventListener('click', function() {
                                openUpgradeModal();
                            });
                            
                            statusCell.appendChild(lockButton);
                        } else {
                            // Unlocked: simple green text
                            const unlockedBadge = document.createElement("span");
                            unlockedBadge.className = "text-emerald-400 text-sm font-medium";
                            unlockedBadge.textContent = "Unlocked";
                            statusCell.appendChild(unlockedBadge);
                        }

                        // Append cells to row
                        row.appendChild(rankCell);
                        row.appendChild(numbersCell);
                        row.appendChild(statusCell);
                        tbody.appendChild(row);
                    }

                    currentlyShown = endIndex;

                    // Update counters
                    document.getElementById("shown-count").textContent =
                        currentlyShown;

                    // Show/hide load more button
                    const loadMoreContainer = document.getElementById(
                        "load-more-container",
                    );
                    if (currentlyShown < allPredictions.length) {
                        loadMoreContainer.classList.remove("hidden");
                        const remaining =
                            allPredictions.length - currentlyShown;
                        const nextLoad = Math.min(
                            PREDICTIONS_PER_LOAD,
                            remaining,
                        );
                        document.getElementById("load-more-count").textContent =
                            `+${nextLoad}`;

                        // Update button text based on remaining
                        const loadMoreText =
                            document.getElementById("load-more-text");
                        if (remaining <= PREDICTIONS_PER_LOAD) {
                            loadMoreText.textContent = "Show All Remaining";
                        } else {
                            loadMoreText.textContent = "Load More Insights";
                        }
                    } else {
                        loadMoreContainer.classList.add("hidden");
                    }
                }

                // Open upgrade modal function
                function openUpgradeModal() {
                    // For now, just open the register modal - we'll convert this to hybrid register+upgrade modal next
                    const registerBtn = document.getElementById('register-btn');
                    if (registerBtn) {
                        registerBtn.click();
                    }
                }

                // Load recent draws
                async function loadRecentDraws() {
                    try {
                        console.log("Loading recent draws...");
                        document
                            .getElementById("draws-loading")
                            .classList.remove("hidden");

                        const response = await fetch(
                            `${API_BASE_URL}/public/draws/recent?limit=50`,
                        );
                        if (!response.ok)
                            throw new Error("Failed to fetch draws");

                        const data = await response.json();
                        const fetchedDraws = data.draws || [];
                        console.log("Loaded all draws:", fetchedDraws.length);

                        if (fetchedDraws.length === 0) {
                            document
                                .getElementById("draws-loading")
                                .classList.add("hidden");
                            document
                                .getElementById("no-draws")
                                .classList.remove("hidden");
                            return;
                        }

                        // OPTIMIZED v5.0: API now returns has_predictions flag
                        // No need to make N+1 queries - data already includes evaluation results
                        const drawsWithPredictions = fetchedDraws.filter(d => d.has_predictions).length;
                        console.log(
                            `Draws loaded: ${fetchedDraws.length} total, ${drawsWithPredictions} with predictions, ${fetchedDraws.length - drawsWithPredictions} without predictions`
                        );

                        // Store all draws globally (now includes draws without predictions)
                        allDraws = fetchedDraws;
                        drawsCurrentlyShown = 0;

                        // Update total count
                        document.getElementById("draws-total-available").textContent = 
                            allDraws.length;

                        // Show initial draws
                        showMoreDraws();

                        document
                            .getElementById("draws-loading")
                            .classList.add("hidden");
                        document
                            .getElementById("draws-grid")
                            .classList.remove("hidden");
                    } catch (error) {
                        console.error("Error loading draws:", error);
                        document
                            .getElementById("draws-loading")
                            .classList.add("hidden");
                        document
                            .getElementById("no-draws")
                            .classList.remove("hidden");
                    }
                }

                // Show more draws function (pagination)
                function showMoreDraws() {
                    const grid = document.getElementById("draws-grid");
                    const loadMoreContainer = document.getElementById(
                        "load-more-draws-container",
                    );

                    const startIndex = drawsCurrentlyShown;
                    const endIndex = Math.min(
                        startIndex + DRAWS_PER_LOAD,
                        allDraws.length,
                    );

                    for (let i = startIndex; i < endIndex; i++) {
                        const draw = allDraws[i];
                        const drawCard = document.createElement("div");
                        drawCard.className =
                            "bg-canvas-surface rounded-lg p-4 border border-canvas-line hover:shadow-md transition-all cursor-pointer hover:bg-canvas-surface/80";

                        // Fix date parsing to avoid timezone issues
                        const dateParts = draw.draw_date.split("-");
                        const fixedDate = new Date(
                            parseInt(dateParts[0]),
                            parseInt(dateParts[1]) - 1,
                            parseInt(dateParts[2]),
                        );
                        const formattedDate = fixedDate.toLocaleDateString(
                            "en-US",
                            {
                                weekday: "short",
                                month: "short",
                                day: "numeric",
                                year: "numeric",
                            },
                        );

                        // Format total prize
                        let prizeDisplay = '';
                        let prizeClass = '';
                        const totalPrize = draw.total_prize || 0;
                        
                        if (totalPrize >= 100000000) {
                            prizeDisplay = 'üí∞ JACKPOT!';
                            prizeClass = 'bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 text-white font-bold px-3 py-1 rounded-full shadow-lg text-xs';
                        } else if (totalPrize >= 1000000) {
                            prizeDisplay = `$${(totalPrize / 1000000).toFixed(1)}M`;
                            prizeClass = 'bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold px-3 py-1 rounded-full shadow-md text-xs';
                        } else if (totalPrize >= 1000) {
                            prizeDisplay = `$${(totalPrize / 1000).toFixed(1)}K`;
                            prizeClass = 'bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold px-3 py-1 rounded-full shadow-md text-xs';
                        } else if (totalPrize > 0) {
                            prizeDisplay = `$${totalPrize.toFixed(0)}`;
                            prizeClass = 'bg-gradient-to-r from-gray-400 to-gray-500 text-white font-medium px-3 py-1 rounded-full text-xs';
                        } else {
                            prizeDisplay = '$0';
                            prizeClass = 'bg-gray-700/50 text-gray-400 font-medium px-3 py-1 rounded-full text-xs';
                        }

                        // Check if draw has predictions (new field from v5.0)
                        // Badge debajo de la fecha, m√°s peque√±o
                        const noPredictionsBadge = !draw.has_predictions 
                            ? '<span class="bg-yellow-500/20 text-yellow-400 text-[9px] px-1.5 py-0.5 rounded-full font-medium">No predictions</span>'
                            : '';

                        drawCard.innerHTML = `
                        <!-- Mobile: improved layout with visual hierarchy -->
                        <div class="flex flex-col space-y-3 sm:hidden">
                            <div class="flex items-center justify-between border-b border-white/5 pb-2">
                                <div class="flex flex-col gap-1">
                                    <h4 class="text-sm font-semibold text-white">${formattedDate}</h4>
                                    ${noPredictionsBadge ? `<div>${noPredictionsBadge}</div>` : ''}
                                    <p class="text-[10px] text-white/50">View ${draw.has_predictions ? 'matches' : 'details'}</p>
                                </div>
                                <i class="fas fa-chevron-right text-white/30 text-lg"></i>
                            </div>
                            <div class="flex items-center justify-center gap-1.5 flex-wrap">
                                <span class="num-chip text-xs w-7 h-7">${draw.n1}</span>
                                <span class="num-chip text-xs w-7 h-7">${draw.n2}</span>
                                <span class="num-chip text-xs w-7 h-7">${draw.n3}</span>
                                <span class="num-chip text-xs w-7 h-7">${draw.n4}</span>
                                <span class="num-chip text-xs w-7 h-7">${draw.n5}</span>
                                <div class="w-0.5"></div>
                                <span class="num-chip powerball-chip text-xs w-7 h-7">${draw.pb}</span>
                            </div>
                            <div class="flex items-center justify-between pt-1 border-t border-white/5">
                                <span class="text-[10px] text-white/50 uppercase tracking-wide">AI Winnings</span>
                                <span class="${prizeClass} text-xs">${prizeDisplay}</span>
                            </div>
                        </div>
                        
                        <!-- Desktop: horizontal layout -->
                        <div class="hidden sm:flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="text-left">
                                    <h4 class="text-sm font-semibold text-white">
                                        ${formattedDate}
                                    </h4>
                                    ${noPredictionsBadge ? `<div class="mt-0.5">${noPredictionsBadge}</div>` : ''}
                                    <p class="text-xs text-white/60 ${noPredictionsBadge ? 'mt-0.5' : 'mt-1'}">View ${draw.has_predictions ? 'matches' : 'details'}</p>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <span class="num-chip">${draw.n1}</span>
                                    <span class="num-chip">${draw.n2}</span>
                                    <span class="num-chip">${draw.n3}</span>
                                    <span class="num-chip">${draw.n4}</span>
                                    <span class="num-chip">${draw.n5}</span>
                                    <div class="w-2"></div>
                                    <span class="num-chip powerball-chip">${draw.pb}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="text-center">
                                    <p class="text-xs text-white/50 mb-1">AI Winnings</p>
                                    <span class="${prizeClass}">${prizeDisplay}</span>
                                </div>
                                <div class="text-right">
                                    <i class="fas fa-chevron-right text-white/40"></i>
                                </div>
                            </div>
                        </div>
                    `;

                        // Add click event to open modal
                        drawCard.addEventListener("click", () => {
                            showDrawMatchesModal(draw.draw_date);
                        });

                        grid.appendChild(drawCard);
                    }

                    drawsCurrentlyShown = endIndex;

                    // Update shown count
                    document.getElementById("draws-shown-count").textContent =
                        drawsCurrentlyShown;

                    // Show/hide load more button
                    const remaining = allDraws.length - drawsCurrentlyShown;
                    if (remaining > 0) {
                        loadMoreContainer.classList.remove("hidden");

                        // Calculate next load count
                        const nextLoad = Math.min(remaining, DRAWS_PER_LOAD);
                        document.getElementById("load-more-draws-count").textContent =
                            `+${nextLoad}`;

                        // Update button text based on remaining
                        const loadMoreText =
                            document.getElementById("load-more-draws-text");
                        if (remaining <= DRAWS_PER_LOAD) {
                            loadMoreText.textContent = "Show All Remaining";
                        } else {
                            loadMoreText.textContent = "Load More Draws";
                        }
                    } else {
                        loadMoreContainer.classList.add("hidden");
                    }
                }

                // Initialize - load all data
                try {
                    console.log("Starting initialization...");
                    await Promise.all([loadPredictions(), loadRecentDraws(), loadJackpot(), loadWinnersStats(), loadStats()]);

                    // Setup load more button event listeners
                    document
                        .getElementById("load-more-btn")
                        .addEventListener("click", function () {
                            showMorePredictions();
                        });

                    document
                        .getElementById("load-more-draws-btn")
                        .addEventListener("click", function () {
                            showMoreDraws();
                        });

                    console.log("All data loaded successfully");
                } catch (error) {
                    console.error("Error during initialization:", error);
                }
            });

            // Modal functions: legacy inline implementation removed to avoid conflict with centralized public.js
            // The global `showDrawMatchesModal` now delegates to `fetchDrawAnalytics` when available.

            function closeDrawMatchesModal() {
                const modal = document.getElementById("drawMatchesModal");
                if (modal) {
                    modal.classList.add("hidden");
                }
            }

            function displayModalWinningNumbers(drawNumbers) {
                if (!drawNumbers) return;

                const numbersContainer = document.getElementById(
                    "modal-winning-numbers",
                );
                const powerballContainer = document.getElementById(
                    "modal-winning-powerball",
                );

                numbersContainer.innerHTML = "";
                powerballContainer.innerHTML = "";

                // Add white balls from draw_numbers structure
                const winningNumbers = [
                    drawNumbers.n1,
                    drawNumbers.n2,
                    drawNumbers.n3,
                    drawNumbers.n4,
                    drawNumbers.n5,
                ].filter((n) => n);
                winningNumbers.forEach((num) => {
                    const ball = document.createElement("span");
                    ball.className = "num-chip";
                    ball.textContent = num;
                    numbersContainer.appendChild(ball);
                });

                // Add powerball
                if (drawNumbers.pb) {
                    const ball = document.createElement("span");
                    ball.className = "num-chip powerball-chip";
                    ball.textContent = drawNumbers.pb;
                    powerballContainer.appendChild(ball);
                }
            }

            function displayModalDrawDate(drawDate) {
                const dateElement = document.getElementById("modal-draw-date");
                if (dateElement && drawDate) {
                    const date = new Date(drawDate + "T00:00:00");
                    const formattedDate = date.toLocaleDateString("en-US", {
                        weekday: "long",
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                    });
                    dateElement.textContent = `Draw Date: ${formattedDate}`;
                }
            }

            function calculatePrizeAmount(mainMatches, powerballMatch) {
                if (mainMatches === 5 && powerballMatch) {
                    return { amount: 100000000.0, description: "Jackpot" };
                } else if (mainMatches === 5) {
                    return { amount: 1000000.0, description: "Match 5" };
                } else if (mainMatches === 4 && powerballMatch) {
                    return {
                        amount: 50000.0,
                        description: "Match 4 + Powerball",
                    };
                } else if (mainMatches === 4) {
                    return { amount: 100.0, description: "Match 4" };
                } else if (mainMatches === 3 && powerballMatch) {
                    return {
                        amount: 100.0,
                        description: "Match 3 + Powerball",
                    };
                } else if (mainMatches === 3) {
                    return { amount: 7.0, description: "Match 3" };
                } else if (mainMatches === 2 && powerballMatch) {
                    return { amount: 7.0, description: "Match 2 + Powerball" };
                } else if (mainMatches === 1 && powerballMatch) {
                    return { amount: 4.0, description: "Match 1 + Powerball" };
                } else if (powerballMatch) {
                    return { amount: 4.0, description: "Powerball Only" };
                } else {
                    return { amount: 0.0, description: "No Prize" };
                }
            }

            function getBestMatchDescription(predictions) {
                if (predictions.length === 0) return "None";

                let bestMainMatches = 0;
                let hasPowerballMatch = false;

                predictions.forEach((pred) => {
                    if (
                        pred.matches_main > bestMainMatches ||
                        (pred.matches_main === bestMainMatches &&
                            pred.matches_powerball &&
                            !hasPowerballMatch)
                    ) {
                        bestMainMatches = pred.matches_main;
                        if (pred.matches_powerball) hasPowerballMatch = true;
                    }
                });

                if (bestMainMatches === 0 && !hasPowerballMatch) return "None";
                return `${bestMainMatches}${hasPowerballMatch ? "+PB" : ""} matches`;
            }

            function displayModalSummary(summary) {
                if (!summary) return;

                document.getElementById("modal-total-predictions").textContent =
                    summary.total_predictions || 0;
                document.getElementById("modal-matches-found").textContent =
                    summary.total_with_matches || 0;
                document.getElementById("modal-best-match").textContent =
                    summary.best_match_description || "None";
                document.getElementById("modal-total-prizes").textContent =
                    `$${(summary.total_prizes || 0).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            function displayModalPredictions(
                predictions,
                winningNumbers,
                idToRankMap,
            ) {
                const tbody = document.getElementById(
                    "modal-predictions-tbody",
                );
                const list = document.getElementById("modal-predictions-list");
                const isMobile = window.innerWidth < 640;
                
                tbody.innerHTML = "";
                if (list) list.innerHTML = "";

                if (predictions.length === 0) {
                    const emptyMsg = `
                        <div class="px-4 py-8 text-center text-white/60">
                            <i class="fas fa-trophy text-2xl mb-2"></i>
                            <br>
                            No winning AI insights found for this draw.
                            <br>
                            <span class="text-sm">Try again with the next drawing!</span>
                        </div>
                    `;
                    
                    if (isMobile && list) {
                        list.innerHTML = emptyMsg;
                    } else {
                        const row = document.createElement("tr");
                        row.innerHTML = `<td colspan="6" class="px-4 py-8 text-center text-white/60">
                            <i class="fas fa-trophy text-2xl mb-2"></i>
                            <br>
                            No winning AI insights found for this draw.
                            <br>
                            <span class="text-sm">Try again with the next drawing!</span>
                        </td>`;
                        tbody.appendChild(row);
                    }
                    return;
                }

                // Extract winning numbers for comparison
                const winningMainNumbers = winningNumbers
                    ? [
                          winningNumbers.n1,
                          winningNumbers.n2,
                          winningNumbers.n3,
                          winningNumbers.n4,
                          winningNumbers.n5,
                      ]
                    : [];
                const winningPowerball = winningNumbers
                    ? winningNumbers.pb
                    : null;

                predictions.forEach((pred, index) => {
                    // Create number balls HTML with highlighting for matches
                    const numbers = [
                        pred.n1,
                        pred.n2,
                        pred.n3,
                        pred.n4,
                        pred.n5,
                    ].filter((n) => n);
                    
                    const matchesText = `${pred.matches_main || 0}${pred.matches_powerball ? "+PB" : ""}`;
                    const prizeAmount = pred.prize_info
                        ? pred.prize_info.amount
                        : 0;
                    const prizeText =
                        prizeAmount > 0
                            ? `$${prizeAmount.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                            : "-";

                    // Highlight Powerball if it matches
                    const pbMatch = pred.pb === winningPowerball;
                    
                    // Mobile: card layout
                    if (isMobile && list) {
                        const numbersHtml = numbers
                            .map((num) => {
                                const isMatch = winningMainNumbers.includes(num);
                                if (isMatch) {
                                    return `<span class="num-chip text-xs w-7 h-7" style="background: #00e0ff; color: #0a0c14;">${num}</span>`;
                                } else {
                                    return `<span class="num-chip text-xs w-7 h-7">${num}</span>`;
                                }
                            })
                            .join("");
                        
                        const powerballHtml = pbMatch 
                            ? `<span class="num-chip powerball-chip text-xs w-7 h-7" style="background: #00e0ff; color: #0a0c14;">${pred.pb}</span>`
                            : `<span class="num-chip powerball-chip text-xs w-7 h-7">${pred.pb}</span>`;
                        
                        const cardDiv = document.createElement("div");
                        cardDiv.className = "bg-canvas-card rounded-lg border border-white/5 p-4 space-y-3";
                        cardDiv.innerHTML = `
                            <div class="flex items-center justify-between border-b border-white/5 pb-2">
                                <div class="flex items-center gap-2">
                                    <span class="inline-flex items-center justify-center w-8 h-6 rounded-md bg-gradient-to-r from-canvas-accent to-canvas-accent2 text-white text-sm font-bold shadow-md">
                                        #${idToRankMap[pred.id] || index + 1}
                                    </span>
                                    <span class="text-xs text-white/60">${pred.strategy_used || 'AI'}</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-white/50">Matches</div>
                                    <div class="text-sm font-bold text-white">${matchesText}</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-center gap-1.5 flex-wrap">
                                ${numbersHtml}
                                <div class="w-0.5"></div>
                                ${powerballHtml}
                            </div>
                            <div class="flex items-center justify-between pt-1 border-t border-white/5">
                                <span class="text-[10px] text-white/50 uppercase tracking-wide">Prize</span>
                                <span class="text-sm font-bold ${prizeAmount > 0 ? 'text-emerald-400' : 'text-white/40'}">${prizeText}</span>
                            </div>
                        `;
                        list.appendChild(cardDiv);
                    } else {
                        // Desktop: table row
                        const numbersHtml = numbers
                            .map((num) => {
                                const isMatch = winningMainNumbers.includes(num);
                                if (isMatch) {
                                    return `<span class="num-chip" style="background: #00e0ff; color: #0a0c14;">${num}</span>`;
                                } else {
                                    return `<span class="num-chip">${num}</span>`;
                                }
                            })
                            .join("");
                        
                        const powerballHtml = pbMatch 
                            ? `<span class="num-chip" style="background: #00e0ff; color: #0a0c14;">${pred.pb}</span>`
                            : `<span class="num-chip powerball-chip">${pred.pb}</span>`;

                        const row = document.createElement("tr");
                        row.className = "hover:bg-canvas-card/30 transition-colors";
                        row.innerHTML = `
                            <td class="px-4 py-3 text-sm text-white font-bold">#${idToRankMap[pred.id] || index + 1}</td>
                            <td class="px-4 py-3">
                                <div class="flex items-center justify-start gap-1">
                                    ${numbersHtml}
                                </div>
                            </td>
                            <td class="px-4 py-3">
                                <div class="flex items-center justify-center">
                                    ${powerballHtml}
                                </div>
                            </td>
                            <td class="px-4 py-3 text-sm text-white/70">${pred.strategy_used || 'AI'}</td>
                            <td class="px-4 py-3 text-sm font-medium text-white">${matchesText}</td>
                            <td class="px-4 py-3 text-sm font-medium text-white">${prizeText}</td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            }

            // Countdown functionality
            function getNextDrawingDate() {
                const now = new Date();
                const et = new Date(
                    now.toLocaleString("en-US", {
                        timeZone: "America/New_York",
                    }),
                );
                let nextDrawing = new Date(et);

                const currentDay = et.getDay(); // Sunday = 0, Monday = 1, ..., Saturday = 6
                const currentHour = et.getHours();
                const currentMinute = et.getMinutes();

                let daysToAdd = 0;

                // Powerball drawings: Monday (1), Wednesday (3), Saturday (6) at 10:59 PM ET
                if (currentDay === 0) {
                    // Sunday
                    daysToAdd = 1; // Next Monday
                } else if (currentDay === 1) {
                    // Monday
                    if (
                        currentHour < 22 ||
                        (currentHour === 22 && currentMinute < 59)
                    ) {
                        daysToAdd = 0; // Today
                    } else {
                        daysToAdd = 2; // Next Wednesday
                    }
                } else if (currentDay === 2) {
                    // Tuesday
                    daysToAdd = 1; // Next Wednesday
                } else if (currentDay === 3) {
                    // Wednesday
                    if (
                        currentHour < 22 ||
                        (currentHour === 22 && currentMinute < 59)
                    ) {
                        daysToAdd = 0; // Today
                    } else {
                        daysToAdd = 3; // Next Saturday
                    }
                } else if (currentDay === 4 || currentDay === 5) {
                    // Thursday or Friday
                    daysToAdd = 6 - currentDay; // Next Saturday
                } else if (currentDay === 6) {
                    // Saturday
                    if (
                        currentHour < 22 ||
                        (currentHour === 22 && currentMinute < 59)
                    ) {
                        daysToAdd = 0; // Today
                    } else {
                        daysToAdd = 2; // Next Monday
                    }
                }

                nextDrawing.setDate(et.getDate() + daysToAdd);
                nextDrawing.setHours(22, 59, 0, 0); // 10:59 PM ET

                return nextDrawing;
            }

            function formatCountdown(timeDiff) {
                if (timeDiff <= 0) {
                    return "Drawing in Progress";
                }

                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor(
                    (timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
                );
                const minutes = Math.floor(
                    (timeDiff % (1000 * 60 * 60)) / (1000 * 60),
                );
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                let result = "";
                if (days > 0) {
                    result += `${days}d `;
                }
                result += `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

                return result;
            }

            function updateCountdown() {
                const nextDrawing = getNextDrawingDate();
                const now = new Date();
                const timeDiff = nextDrawing.getTime() - now.getTime();

                // Update date display
                const dateElement =
                    document.getElementById("next-drawing-date");
                if (dateElement) {
                    const formattedDate = nextDrawing.toLocaleDateString(
                        "en-US",
                        {
                            weekday: "long",
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                            timeZone: "America/New_York",
                        },
                    );
                    const formattedTime = nextDrawing.toLocaleTimeString(
                        "en-US",
                        {
                            hour: "numeric",
                            minute: "2-digit",
                            hour12: true,
                            timeZone: "America/New_York",
                        },
                    );
                    dateElement.textContent = `${formattedDate} at ${formattedTime} ET`;
                }

                // Update countdown display
                const countdownElement =
                    document.getElementById("countdown-display");
                if (countdownElement) {
                    countdownElement.textContent = formatCountdown(timeDiff);

                    // Change colors based on time remaining
                    countdownElement.className = "text-4xl font-bold mb-2 ";
                    if (timeDiff <= 0) {
                        countdownElement.className +=
                            "text-red-600 dark:text-red-400 animate-pulse";
                    } else if (timeDiff <= 3600000) {
                        // 1 hour
                        countdownElement.className +=
                            "text-orange-600 dark:text-orange-400";
                    } else if (timeDiff <= 86400000) {
                        // 24 hours
                        countdownElement.className +=
                            "text-yellow-600 dark:text-yellow-400";
                    } else {
                        countdownElement.className +=
                            "text-blue-600 dark:text-blue-400";
                    }
                }
            }

            function initializeCountdown() {
                updateCountdown();
                setInterval(updateCountdown, 1000);
            }

            // Close modal when clicking outside
            document.addEventListener("click", (e) => {
                const modal = document.getElementById("drawMatchesModal");
                if (e.target === modal) {
                    closeDrawMatchesModal();
                }
            });

            // Device fingerprinting and counters
            function generateFingerprint() {
                const screen = window.screen;
                const navigator = window.navigator;
                const fingerprint = [
                    screen.width,
                    screen.height,
                    screen.colorDepth,
                    navigator.language,
                    navigator.platform,
                    new Date().getTimezoneOffset(),
                    navigator.hardwareConcurrency || "unknown",
                ].join("|");

                // Create simple hash
                let hash = 0;
                for (let i = 0; i < fingerprint.length; i++) {
                    const char = fingerprint.charCodeAt(i);
                    hash = (hash << 5) - hash + char;
                    hash = hash & hash;
                }
                return "device_" + Math.abs(hash).toString(36);
            }

            async function registerVisit() {
                const fingerprint = generateFingerprint();
                const visited = localStorage.getItem("shiol_visited");

                if (!visited) {
                    try {
                        const response = await fetch(
                            "/api/v1/public/register-visit",
                            {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ fingerprint }),
                            },
                        );

                        if (response.ok) {
                            const data = await response.json();
                            if (data.new_visit) {
                                localStorage.setItem("shiol_visited", "true");
                            }
                        }
                    } catch (error) {
                        console.error("Error registering visit:", error);
                    }
                }
            }


            // Initialize on page load
            document.addEventListener("DOMContentLoaded", () => {
                registerVisit();
                
                // Initialize countdown badge in jackpot card
                if (window.CountdownUtils) {
                    const countdownHero = document.getElementById('countdown-hero');
                    const nextDrawingDateEl = document.getElementById('next-drawing-date');
                    
                    if (countdownHero) {
                        function updateCountdownBadges() {
                            const nextDrawingDate = CountdownUtils.getNextDrawingDate();
                            const now = new Date();
                            const timeDiff = nextDrawingDate.getTime() - now.getTime();
                            
                            // Update countdown
                            if (timeDiff > 0) {
                                const countdownText = CountdownUtils.formatCountdown(timeDiff, 'minimal');
                                countdownHero.textContent = countdownText;
                            } else {
                                countdownHero.textContent = 'Drawing Soon!';
                            }
                            
                            // Update draw date display (simple format)
                            if (nextDrawingDateEl) {
                                const options = { 
                                    weekday: 'short', 
                                    month: 'short', 
                                    day: 'numeric',
                                    hour: 'numeric',
                                    minute: '2-digit',
                                    hour12: true,
                                    timeZone: 'America/New_York'
                                };
                                const formattedDate = nextDrawingDate.toLocaleDateString('en-US', options);
                                nextDrawingDateEl.textContent = `${formattedDate} ET`;
                            }
                        }
                        
                        updateCountdownBadges();
                        setInterval(updateCountdownBadges, 1000);
                    }
                }
            });
        </script>

        <!-- Load scripts in correct order: text constants ‚Üí utilities ‚Üí auth ‚Üí ticket verification -->
        <!-- Core JavaScript Files - Load Order Critical -->
        <script src="js/text-constants.js"></script>
        <script src="js/countdown.js"></script>
        <script src="js/device-fingerprint.js"></script>
        <script src="js/auth-manager.js"></script>
        <script src="js/ticket-verification.js"></script>
        <script src="js/analytics-modal.js"></script>
        <script src="js/account-settings-modal.js"></script>
        <script src="js/demo-mode.js"></script>
        <script src="js/public.js"></script>
        
        <!-- Unregister Service Worker (PWA Removed) -->
        <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        console.log('üóëÔ∏è Unregistering service worker to prevent cache issues');
                        await registration.unregister();
                    }
                    console.log('‚úÖ All service workers removed - cache issues resolved');
                } catch (error) {
                    console.log('Service Worker cleanup failed:', error);
                }
            });
        }
        </script>

        <!-- Authentication Modals -->
        <!-- Login Modal -->
        <div id="login-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm overflow-y-auto h-full w-full z-50" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
            <div class="relative top-20 mx-auto p-6 border border-canvas-line w-96 shadow-2xl rounded-xl bg-canvas-card">
                <div class="mt-3">
                    <div class="flex items-center justify-between mb-6">
                        <h3 id="login-modal-title" class="text-xl font-semibold text-white">Login to SHIOL+</h3>
                        <button id="login-close" class="text-white/60 hover:text-white transition-colors">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                    </div>
                    
                    <!-- Admin Required Context Message -->
                    <div id="login-admin-context" class="hidden mb-4 bg-blue-500/10 border border-blue-500/30 text-blue-400 px-4 py-3 rounded-md text-sm">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Sign in as administrator to access system status panel
                    </div>
                    
                    <form id="login-form" class="space-y-4">
                        <div id="login-error" class="hidden bg-canvas-accent2/10 border border-canvas-accent2/30 text-canvas-accent2 px-4 py-3 rounded-md text-sm">
                        </div>
                        
                        <div>
                            <label for="login-email" class="block text-sm font-medium text-white/80 mb-2">
                                Email or Username
                            </label>
                            <input
                                type="text"
                                id="login-email"
                                required
                                class="w-full px-3 py-2 bg-canvas-surface border border-canvas-line rounded-md focus:outline-none focus:ring-2 focus:ring-canvas-accent text-white placeholder-white/40"
                                placeholder="Enter your email or username"
                            />
                        </div>
                        
                        <div>
                            <label for="login-password" class="block text-sm font-medium text-white/80 mb-2">
                                Password
                            </label>
                            <input
                                type="password"
                                id="login-password"
                                autocomplete="current-password"
                                required
                                class="w-full px-3 py-2 bg-canvas-surface border border-canvas-line rounded-md focus:outline-none focus:ring-2 focus:ring-canvas-accent text-white placeholder-white/40"
                                placeholder="Enter your password"
                            />
                        </div>
                        
                        <div class="flex items-center">
                            <input
                                type="checkbox"
                                id="login-remember-me"
                                class="w-4 h-4 bg-canvas-surface border border-canvas-line rounded focus:ring-2 focus:ring-canvas-accent text-canvas-accent cursor-pointer"
                            />
                            <label for="login-remember-me" class="ml-2 text-sm text-white/80 cursor-pointer select-none">
                                Remember me
                            </label>
                        </div>
                        
                        <button
                            type="submit"
                            id="login-submit"
                            class="w-full bg-gradient-to-r from-canvas-accent to-canvas-accent2 hover:opacity-90 text-white font-medium py-2 px-4 rounded-md transition-all duration-200"
                        >
                            <span id="login-submit-text">Login</span>
                            <i id="login-spinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                        </button>
                        
                        <!-- Demo Credentials -->
                        <div class="text-center text-xs text-white/50 space-y-0.5">
                            <p class="font-medium text-white/60">Demo:</p>
                            <p>User: <span class="font-mono text-white/70">demo</span></p>
                            <p>Pass: <span class="font-mono text-white/70">Demo2025!</span></p>
                        </div>
                    </form>
                    
                    <div class="mt-6 text-center">
                        <p class="text-sm text-white/60">
                            Don't have an account? 
                            <button id="switch-to-register" class="text-canvas-accent hover:text-canvas-accent/80 font-medium transition-colors">
                                Register here
                            </button>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Authentication handled by external auth-manager.js -->

        <!-- Upgrade Modal with Internal Views -->
        <div id="upgrade-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="upgrade-modal-title">
            <div class="modal-content bg-canvas-card border border-canvas-line rounded-xl shadow-2xl max-w-md w-full relative">
                <!-- Close Button -->
                <button class="modal-close-btn" onclick="window.authManager?.hideUpgradeModal()">
                    <i class="fas fa-times"></i>
                </button>

                <!-- OFFER VIEW - Default view for premium offer -->
                <div id="upgrade-offer-view" class="upgrade-modal-view">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-circle text-canvas-accent text-sm mr-2"></i>
                            <h2 class="text-2xl font-bold">Upgrade to Premium</h2>
                        </div>
                        <p class="opacity-90">Unlock all 200 AI insights</p>
                    </div>

                    <!-- Pricing Section -->
                    <div class="px-8 py-6 text-center">
                        <div class="text-5xl font-bold text-canvas-accent mb-2">$9.99</div>
                        <div class="text-white/60 text-sm mb-3">per year</div>
                        <div class="text-white/70 text-sm">
                            Less than $0.83/month ¬∑ Cancel anytime
                        </div>
                    </div>

                    <!-- Features List (3 key features only) -->
                    <div class="px-8 pb-4 space-y-3">
                        <div class="flex items-center text-white/80 text-sm">
                            <i class="fas fa-check-circle text-canvas-accent mr-3"></i>
                            <span>200 AI insights per drawing</span>
                        </div>
                        <div class="flex items-center text-white/80 text-sm">
                            <i class="fas fa-check-circle text-canvas-accent mr-3"></i>
                            <span>Advanced ML algorithm analysis</span>
                        </div>
                        <div class="flex items-center text-white/80 text-sm">
                            <i class="fas fa-check-circle text-canvas-accent mr-3"></i>
                            <span>Historical performance tracking</span>
                        </div>
                    </div>

                    <!-- CTA Section for Offer View -->
                    <div class="modal-cta-section">
                        <button class="modal-upgrade-btn" onclick="window.authManager?.handleUpgradeClick()">
                            <span>Upgrade to Premium ‚Äì $9.99/year</span>
                        </button>
                    </div>
                </div>

                <!-- REGISTER VIEW - Registration form integrated into upgrade modal -->
                <div id="upgrade-register-view" class="upgrade-modal-view hidden">
                    <!-- Modal Header for Registration -->
                    <div class="modal-header">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-circle text-canvas-accent text-sm mr-2"></i>
                            <h2 class="text-2xl font-bold">Go Premium Access</h2>
                        </div>
                        <p class="opacity-90">Unlock all 200 AI insights instantly</p>
                    </div>

                    <!-- Pricing Section -->
                    <div class="px-8 py-6 text-center">
                        <div class="text-5xl font-bold text-canvas-accent mb-2">$9.99</div>
                        <div class="text-white/60 text-sm mb-3">per year</div>
                        <div class="text-white/70 text-sm">
                            Less than $0.83/month ¬∑ Cancel anytime
                        </div>
                    </div>

                    <!-- Create Account Section -->
                    <div class="px-8 pt-4">
                        <div class="text-center mb-4">
                            <h4 class="text-lg font-semibold text-white">Create Your Premium Account</h4>
                        </div>
                        
                        <form id="register-form" class="space-y-4">
                            <div id="register-error" class="hidden bg-canvas-accent2/10 border border-canvas-accent2/30 text-canvas-accent2 px-4 py-3 rounded-md text-sm">
                            </div>
                            
                            <div>
                                <label for="register-email" class="block text-sm font-medium text-white/80 mb-2">
                                    Email Address
                                </label>
                                <input
                                    type="email"
                                    id="register-email"
                                    required
                                    class="w-full px-3 py-2 border border-canvas-line bg-canvas-surface rounded-md focus:outline-none focus:ring-2 focus:ring-canvas-accent text-white placeholder-white/40 transition-all duration-200"
                                    placeholder="Enter your email"
                                />
                            </div>
                            
                            <div>
                                <label for="register-username" class="block text-sm font-medium text-white/80 mb-2">
                                    Username
                                </label>
                                <input
                                    type="text"
                                    id="register-username"
                                    required
                                    minlength="3"
                                    maxlength="20"
                                    class="w-full px-3 py-2 border border-canvas-line bg-canvas-surface rounded-md focus:outline-none focus:ring-2 focus:ring-canvas-accent text-white placeholder-white/40 transition-all duration-200"
                                    placeholder="Choose a username (3-20 characters)"
                                />
                            </div>
                            
                            <div>
                                <label for="register-password" class="block text-sm font-medium text-white/80 mb-2">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    id="register-password"
                                    autocomplete="new-password"
                                    required
                                    minlength="6"
                                    class="w-full px-3 py-2 border border-canvas-line bg-canvas-surface rounded-md focus:outline-none focus:ring-2 focus:ring-canvas-accent text-white placeholder-white/40 transition-all duration-200"
                                    placeholder="Create a password (min 6 characters)"
                                />
                            </div>
                            
                            <!-- Terms and Privacy Checkbox -->
                            <div class="mt-4">
                                <label class="flex items-start text-sm text-white/80 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        id="register-terms-checkbox"
                                        required
                                        class="mt-1 mr-2 w-4 h-4 text-canvas-accent bg-canvas-surface border-canvas-line rounded focus:ring-2 focus:ring-canvas-accent cursor-pointer"
                                    />
                                    <span>
                                        I agree to the 
                                        <a href="/terms" target="_blank" rel="noopener noreferrer" class="text-canvas-accent hover:underline font-medium">Terms of Service</a> 
                                        and 
                                        <a href="/privacy" target="_blank" rel="noopener noreferrer" class="text-canvas-accent hover:underline font-medium">Privacy Policy</a>
                                    </span>
                                </label>
                            </div>
                        </form>
                    </div>

                    <!-- CTA Section for Register View -->
                    <div class="modal-cta-section">
                        <!-- Premium Account Button (Primary) -->
                        <button
                            type="submit"
                            form="register-form"
                            id="register-premium-btn"
                            class="modal-upgrade-btn"
                            data-register-action="premium"
                        >
                            <span id="register-premium-text">Upgrade to Premium ‚Äì $9.99/year</span>
                            <i id="register-premium-spinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                        </button>
                        
                        <div class="text-center text-xs text-white/50 mb-3 mt-2">
                            <i class="fas fa-lock mr-1"></i>
                            Secure payment ¬∑ 200 AI insights ¬∑ Cancel anytime
                        </div>
                        
                        <!-- Divider -->
                        <div class="flex items-center my-4">
                            <div class="flex-1 border-t border-canvas-line"></div>
                            <span class="px-3 text-sm text-white/40">or</span>
                            <div class="flex-1 border-t border-canvas-line"></div>
                        </div>
                        
                        <!-- Free Account Button (Secondary) -->
                        <button
                            type="button"
                            id="register-free-btn"
                            class="w-full bg-canvas-surface border border-canvas-line hover:bg-canvas-surface/80 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                            data-register-action="free"
                        >
                            <span id="register-free-text">Create Free Account (5 AI insights)</span>
                            <i id="register-free-spinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                        </button>
                        
                        <div class="mt-4 text-center">
                            <p class="text-sm text-white/60">
                                Already have an account? 
                                <button id="switch-to-login" class="text-canvas-accent hover:text-canvas-accent/80 font-medium">
                                    Login here
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        
        <!--#include virtual="/includes/footer.html" -->
    </body>
</html>
